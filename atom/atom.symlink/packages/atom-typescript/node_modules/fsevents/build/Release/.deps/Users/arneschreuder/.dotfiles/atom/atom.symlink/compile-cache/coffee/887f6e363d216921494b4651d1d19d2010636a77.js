(function() {
  var basename;

  basename = require("path").basename;

  module.exports = {
    config: {
      coloured: {
        type: 'boolean',
        "default": true,
        description: 'Untick this for colourless icons'
      },
      forceShow: {
        type: 'boolean',
        "default": false,
        description: 'Force show icons - for themes that hide icons'
      },
      onChanges: {
        type: 'boolean',
        "default": false,
        title: 'Only colour when changed',
        description: 'Show different icon colours for modified files only. Requires that project be a Git repository.'
      },
      tabPaneIcon: {
        type: 'boolean',
        "default": true,
        title: 'Show icons in file tabs'
      }
    },
    activate: function(state) {
      var colouredIcons;
      this.disableSetiIcons(true);
      colouredIcons = "file-icons.coloured";
      atom.config.onDidChange(colouredIcons, (function(_this) {
        return function(arg) {
          var newValue, oldValue;
          newValue = arg.newValue, oldValue = arg.oldValue;
          return _this.colour(newValue);
        };
      })(this));
      this.colour(atom.config.get(colouredIcons));
      atom.commands.add('body', 'file-icons:toggle-colours', function(event) {
        return atom.config.set(colouredIcons, !(atom.config.get(colouredIcons)));
      });
      this.observe(true);
      atom.packages.onDidActivateInitialPackages(function() {
        var i, len, results, selector, tab, tabs;
        selector = '.file-icons-tab-pane-icon .tab[data-type="MarkdownPreviewView"]';
        tabs = atom.views.getView(atom.workspace).querySelectorAll(selector);
        results = [];
        for (i = 0, len = tabs.length; i < len; i++) {
          tab = tabs[i];
          results.push(tab.itemTitle.removeAttribute("data-path"));
        }
        return results;
      });
      atom.config.onDidChange('file-icons.forceShow', (function(_this) {
        return function(arg) {
          var newValue, oldValue;
          newValue = arg.newValue, oldValue = arg.oldValue;
          return _this.forceShow(newValue);
        };
      })(this));
      this.forceShow(atom.config.get('file-icons.forceShow'));
      atom.config.onDidChange('file-icons.onChanges', (function(_this) {
        return function(arg) {
          var newValue, oldValue;
          newValue = arg.newValue, oldValue = arg.oldValue;
          return _this.onChanges(newValue);
        };
      })(this));
      this.onChanges(atom.config.get('file-icons.onChanges'));
      atom.config.onDidChange('file-icons.tabPaneIcon', (function(_this) {
        return function(arg) {
          var newValue, oldValue;
          newValue = arg.newValue, oldValue = arg.oldValue;
          return _this.tabPaneIcon(newValue);
        };
      })(this));
      return this.tabPaneIcon(atom.config.get('file-icons.tabPaneIcon'));
    },
    deactivate: function() {
      this.disableSetiIcons(false);
      this.forceShow(false);
      this.onChanges(false);
      this.colour(true);
      this.tabPaneIcon(false);
      return this.observe(false);
    },
    observe: function(enabled) {
      if (enabled) {
        return this.observer = atom.workspace.observeTextEditors(function(editor) {
          var fixAfterLoading, onSave, openedFile, workspace;
          workspace = atom.views.getView(atom.workspace);
          openedFile = editor.getPath();
          fixAfterLoading = function() {
            var onDone;
            return onDone = editor.onDidStopChanging(function() {
              var fileTabs, tabs;
              tabs = workspace != null ? workspace.querySelectorAll(".pane > .tab-bar > .tab") : void 0;
              fileTabs = [].filter.call(tabs, function(tab) {
                return (tab != null ? tab.item : void 0) === editor;
              });
              editor.onDidChangePath((function(_this) {
                return function(path) {
                  var i, len, results, tab, title;
                  results = [];
                  for (i = 0, len = fileTabs.length; i < len; i++) {
                    tab = fileTabs[i];
                    title = tab.itemTitle;
                    title.dataset.path = path;
                    results.push(title.dataset.name = basename(path));
                  }
                  return results;
                };
              })(this));
              return onDone.dispose();
            });
          };
          if (!openedFile) {
            return onSave = editor.onDidSave(function(file) {
              var fixIcon, onTerminate, tab;
              tab = workspace != null ? workspace.querySelector(".tab-bar > .active.tab > .title") : void 0;
              fixIcon = function() {
                var path;
                if (!(tab != null ? tab.dataset.path : void 0)) {
                  path = file.path;
                  tab.dataset.path = path;
                  tab.dataset.name = basename(path);
                  return fixAfterLoading();
                }
              };
              if (tab) {
                fixIcon();
              } else {
                onTerminate = editor.onDidTerminatePendingState(function() {
                  setTimeout((function() {
                    tab = workspace != null ? workspace.querySelector(".tab-bar > .active.tab > .title") : void 0;
                    return fixIcon();
                  }), 10);
                  return onTerminate.dispose();
                });
              }
              return onSave.dispose();
            });
          } else {
            return fixAfterLoading();
          }
        });
      } else if (this.observer != null) {
        return this.observer.dispose();
      }
    },
    serialize: function() {},
    colour: function(enable) {
      var body;
      body = document.querySelector('body');
      return body.classList.toggle('file-icons-colourless', !enable);
    },
    forceShow: function(enable) {
      var body;
      body = document.querySelector('body');
      return body.classList.toggle('file-icons-force-show-icons', enable);
    },
    onChanges: function(enable) {
      var body;
      body = document.querySelector('body');
      return body.classList.toggle('file-icons-on-changes', enable);
    },
    tabPaneIcon: function(enable) {
      var body;
      body = document.querySelector('body');
      return body.classList.toggle('file-icons-tab-pane-icon', enable);
    },
    disableSetiIcons: function(disable) {
      var workspaceElement;
      workspaceElement = atom.views.getView(atom.workspace);
      return workspaceElement.classList.toggle('seti-ui-no-icons', disable);
    }
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL1VzZXJzL2FybmVzY2hyZXVkZXIvLmRvdGZpbGVzL2F0b20vYXRvbS5zeW1saW5rL3BhY2thZ2VzL2F0b20tdHlwZXNjcmlwdC9ub2RlX21vZHVsZXMvZnNldmVudHMvYnVpbGQvUmVsZWFzZS8uZGVwcy9Vc2Vycy9hcm5lc2NocmV1ZGVyLy5kb3RmaWxlcy9hdG9tL2F0b20uc3ltbGluay9wYWNrYWdlcy9maWxlLWljb25zL2luZGV4LmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUFBLE1BQUE7O0VBQUMsV0FBWSxPQUFBLENBQVEsTUFBUjs7RUFFYixNQUFNLENBQUMsT0FBUCxHQUNFO0lBQUEsTUFBQSxFQUNFO01BQUEsUUFBQSxFQUNFO1FBQUEsSUFBQSxFQUFNLFNBQU47UUFDQSxDQUFBLE9BQUEsQ0FBQSxFQUFTLElBRFQ7UUFFQSxXQUFBLEVBQWEsa0NBRmI7T0FERjtNQUlBLFNBQUEsRUFDRTtRQUFBLElBQUEsRUFBTSxTQUFOO1FBQ0EsQ0FBQSxPQUFBLENBQUEsRUFBUyxLQURUO1FBRUEsV0FBQSxFQUFhLCtDQUZiO09BTEY7TUFRQSxTQUFBLEVBQ0U7UUFBQSxJQUFBLEVBQU0sU0FBTjtRQUNBLENBQUEsT0FBQSxDQUFBLEVBQVMsS0FEVDtRQUVBLEtBQUEsRUFBTywwQkFGUDtRQUdBLFdBQUEsRUFBYSxpR0FIYjtPQVRGO01BYUEsV0FBQSxFQUNFO1FBQUEsSUFBQSxFQUFNLFNBQU47UUFDQSxDQUFBLE9BQUEsQ0FBQSxFQUFTLElBRFQ7UUFFQSxLQUFBLEVBQU8seUJBRlA7T0FkRjtLQURGO0lBbUJBLFFBQUEsRUFBVSxTQUFDLEtBQUQ7QUFDUixVQUFBO01BQUEsSUFBQyxDQUFBLGdCQUFELENBQWtCLElBQWxCO01BRUEsYUFBQSxHQUFnQjtNQUNoQixJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVosQ0FBd0IsYUFBeEIsRUFBdUMsQ0FBQSxTQUFBLEtBQUE7ZUFBQSxTQUFDLEdBQUQ7QUFDckMsY0FBQTtVQUR1Qyx5QkFBVTtpQkFDakQsS0FBQyxDQUFBLE1BQUQsQ0FBUSxRQUFSO1FBRHFDO01BQUEsQ0FBQSxDQUFBLENBQUEsSUFBQSxDQUF2QztNQUVBLElBQUMsQ0FBQSxNQUFELENBQVEsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFaLENBQWdCLGFBQWhCLENBQVI7TUFDQSxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQWQsQ0FBa0IsTUFBbEIsRUFBMEIsMkJBQTFCLEVBQXVELFNBQUMsS0FBRDtlQUNyRCxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQVosQ0FBZ0IsYUFBaEIsRUFBK0IsQ0FBQyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBWixDQUFnQixhQUFoQixDQUFELENBQWhDO01BRHFELENBQXZEO01BR0EsSUFBQyxDQUFBLE9BQUQsQ0FBUyxJQUFUO01BR0EsSUFBSSxDQUFDLFFBQVEsQ0FBQyw0QkFBZCxDQUEyQyxTQUFBO0FBQ3pDLFlBQUE7UUFBQSxRQUFBLEdBQVc7UUFDWCxJQUFBLEdBQU8sSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFYLENBQW1CLElBQUksQ0FBQyxTQUF4QixDQUFrQyxDQUFDLGdCQUFuQyxDQUFvRCxRQUFwRDtBQUNQO2FBQUEsc0NBQUE7O3VCQUNFLEdBQUcsQ0FBQyxTQUFTLENBQUMsZUFBZCxDQUE4QixXQUE5QjtBQURGOztNQUh5QyxDQUEzQztNQU1BLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBWixDQUF3QixzQkFBeEIsRUFBZ0QsQ0FBQSxTQUFBLEtBQUE7ZUFBQSxTQUFDLEdBQUQ7QUFDOUMsY0FBQTtVQURnRCx5QkFBVTtpQkFDMUQsS0FBQyxDQUFBLFNBQUQsQ0FBVyxRQUFYO1FBRDhDO01BQUEsQ0FBQSxDQUFBLENBQUEsSUFBQSxDQUFoRDtNQUVBLElBQUMsQ0FBQSxTQUFELENBQVcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFaLENBQWdCLHNCQUFoQixDQUFYO01BRUEsSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFaLENBQXdCLHNCQUF4QixFQUFnRCxDQUFBLFNBQUEsS0FBQTtlQUFBLFNBQUMsR0FBRDtBQUM5QyxjQUFBO1VBRGdELHlCQUFVO2lCQUMxRCxLQUFDLENBQUEsU0FBRCxDQUFXLFFBQVg7UUFEOEM7TUFBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLENBQWhEO01BRUEsSUFBQyxDQUFBLFNBQUQsQ0FBVyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQVosQ0FBZ0Isc0JBQWhCLENBQVg7TUFFQSxJQUFJLENBQUMsTUFBTSxDQUFDLFdBQVosQ0FBd0Isd0JBQXhCLEVBQWtELENBQUEsU0FBQSxLQUFBO2VBQUEsU0FBQyxHQUFEO0FBQ2hELGNBQUE7VUFEa0QseUJBQVU7aUJBQzVELEtBQUMsQ0FBQSxXQUFELENBQWEsUUFBYjtRQURnRDtNQUFBLENBQUEsQ0FBQSxDQUFBLElBQUEsQ0FBbEQ7YUFFQSxJQUFDLENBQUEsV0FBRCxDQUFhLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBWixDQUFnQix3QkFBaEIsQ0FBYjtJQTdCUSxDQW5CVjtJQW1EQSxVQUFBLEVBQVksU0FBQTtNQUNWLElBQUMsQ0FBQSxnQkFBRCxDQUFrQixLQUFsQjtNQUNBLElBQUMsQ0FBQSxTQUFELENBQVcsS0FBWDtNQUNBLElBQUMsQ0FBQSxTQUFELENBQVcsS0FBWDtNQUNBLElBQUMsQ0FBQSxNQUFELENBQVEsSUFBUjtNQUNBLElBQUMsQ0FBQSxXQUFELENBQWEsS0FBYjthQUNBLElBQUMsQ0FBQSxPQUFELENBQVMsS0FBVDtJQU5VLENBbkRaO0lBNERBLE9BQUEsRUFBUyxTQUFDLE9BQUQ7TUFHUCxJQUFHLE9BQUg7ZUFDRSxJQUFDLENBQUEsUUFBRCxHQUFZLElBQUksQ0FBQyxTQUFTLENBQUMsa0JBQWYsQ0FBa0MsU0FBQyxNQUFEO0FBQzVDLGNBQUE7VUFBQSxTQUFBLEdBQVksSUFBSSxDQUFDLEtBQUssQ0FBQyxPQUFYLENBQW1CLElBQUksQ0FBQyxTQUF4QjtVQUNaLFVBQUEsR0FBYSxNQUFNLENBQUMsT0FBUCxDQUFBO1VBR2IsZUFBQSxHQUFrQixTQUFBO0FBQ2hCLGdCQUFBO21CQUFBLE1BQUEsR0FBUyxNQUFNLENBQUMsaUJBQVAsQ0FBeUIsU0FBQTtBQUNoQyxrQkFBQTtjQUFBLElBQUEsdUJBQU8sU0FBUyxDQUFFLGdCQUFYLENBQTRCLHlCQUE1QjtjQUNQLFFBQUEsR0FBVyxFQUFFLENBQUMsTUFBTSxDQUFDLElBQVYsQ0FBZSxJQUFmLEVBQXFCLFNBQUMsR0FBRDtzQ0FBUyxHQUFHLENBQUUsY0FBTCxLQUFhO2NBQXRCLENBQXJCO2NBR1gsTUFBTSxDQUFDLGVBQVAsQ0FBdUIsQ0FBQSxTQUFBLEtBQUE7dUJBQUEsU0FBQyxJQUFEO0FBQ3JCLHNCQUFBO0FBQUE7dUJBQUEsMENBQUE7O29CQUNFLEtBQUEsR0FBUSxHQUFHLENBQUM7b0JBQ1osS0FBSyxDQUFDLE9BQU8sQ0FBQyxJQUFkLEdBQXFCO2lDQUNyQixLQUFLLENBQUMsT0FBTyxDQUFDLElBQWQsR0FBcUIsUUFBQSxDQUFTLElBQVQ7QUFIdkI7O2dCQURxQjtjQUFBLENBQUEsQ0FBQSxDQUFBLElBQUEsQ0FBdkI7cUJBT0EsTUFBTSxDQUFDLE9BQVAsQ0FBQTtZQVpnQyxDQUF6QjtVQURPO1VBaUJsQixJQUFBLENBQU8sVUFBUDttQkFDRSxNQUFBLEdBQVMsTUFBTSxDQUFDLFNBQVAsQ0FBaUIsU0FBQyxJQUFEO0FBQ3hCLGtCQUFBO2NBQUEsR0FBQSx1QkFBTSxTQUFTLENBQUUsYUFBWCxDQUF5QixpQ0FBekI7Y0FHTixPQUFBLEdBQVUsU0FBQTtBQUNSLG9CQUFBO2dCQUFBLElBQUcsZ0JBQUksR0FBRyxDQUFFLE9BQU8sQ0FBQyxjQUFwQjtrQkFDRyxPQUFRO2tCQUNULEdBQUcsQ0FBQyxPQUFPLENBQUMsSUFBWixHQUFtQjtrQkFDbkIsR0FBRyxDQUFDLE9BQU8sQ0FBQyxJQUFaLEdBQW1CLFFBQUEsQ0FBUyxJQUFUO3lCQUNuQixlQUFBLENBQUEsRUFKRjs7Y0FEUTtjQVFWLElBQUcsR0FBSDtnQkFBWSxPQUFBLENBQUEsRUFBWjtlQUFBLE1BQUE7Z0JBSUUsV0FBQSxHQUFjLE1BQU0sQ0FBQywwQkFBUCxDQUFrQyxTQUFBO2tCQUM5QyxVQUFBLENBQVcsQ0FBQyxTQUFBO29CQUdWLEdBQUEsdUJBQU0sU0FBUyxDQUFFLGFBQVgsQ0FBeUIsaUNBQXpCOzJCQUNOLE9BQUEsQ0FBQTtrQkFKVSxDQUFELENBQVgsRUFNRyxFQU5IO3lCQU9BLFdBQVcsQ0FBQyxPQUFaLENBQUE7Z0JBUjhDLENBQWxDLEVBSmhCOztxQkFlQSxNQUFNLENBQUMsT0FBUCxDQUFBO1lBM0J3QixDQUFqQixFQURYO1dBQUEsTUFBQTttQkFnQ0UsZUFBQSxDQUFBLEVBaENGOztRQXRCNEMsQ0FBbEMsRUFEZDtPQUFBLE1BMERLLElBQUcscUJBQUg7ZUFDSCxJQUFDLENBQUEsUUFBUSxDQUFDLE9BQVYsQ0FBQSxFQURHOztJQTdERSxDQTVEVDtJQTZIQSxTQUFBLEVBQVcsU0FBQSxHQUFBLENBN0hYO0lBZ0lBLE1BQUEsRUFBUSxTQUFDLE1BQUQ7QUFDTixVQUFBO01BQUEsSUFBQSxHQUFPLFFBQVEsQ0FBQyxhQUFULENBQXVCLE1BQXZCO2FBQ1AsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFmLENBQXNCLHVCQUF0QixFQUErQyxDQUFDLE1BQWhEO0lBRk0sQ0FoSVI7SUFvSUEsU0FBQSxFQUFXLFNBQUMsTUFBRDtBQUNULFVBQUE7TUFBQSxJQUFBLEdBQU8sUUFBUSxDQUFDLGFBQVQsQ0FBdUIsTUFBdkI7YUFDUCxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQWYsQ0FBc0IsNkJBQXRCLEVBQXFELE1BQXJEO0lBRlMsQ0FwSVg7SUF3SUEsU0FBQSxFQUFXLFNBQUMsTUFBRDtBQUNULFVBQUE7TUFBQSxJQUFBLEdBQU8sUUFBUSxDQUFDLGFBQVQsQ0FBdUIsTUFBdkI7YUFDUCxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQWYsQ0FBc0IsdUJBQXRCLEVBQStDLE1BQS9DO0lBRlMsQ0F4SVg7SUE0SUEsV0FBQSxFQUFhLFNBQUMsTUFBRDtBQUNYLFVBQUE7TUFBQSxJQUFBLEdBQU8sUUFBUSxDQUFDLGFBQVQsQ0FBdUIsTUFBdkI7YUFDUCxJQUFJLENBQUMsU0FBUyxDQUFDLE1BQWYsQ0FBc0IsMEJBQXRCLEVBQWtELE1BQWxEO0lBRlcsQ0E1SWI7SUFnSkEsZ0JBQUEsRUFBa0IsU0FBQyxPQUFEO0FBQ2hCLFVBQUE7TUFBQSxnQkFBQSxHQUFtQixJQUFJLENBQUMsS0FBSyxDQUFDLE9BQVgsQ0FBbUIsSUFBSSxDQUFDLFNBQXhCO2FBQ25CLGdCQUFnQixDQUFDLFNBQVMsQ0FBQyxNQUEzQixDQUFrQyxrQkFBbEMsRUFBc0QsT0FBdEQ7SUFGZ0IsQ0FoSmxCOztBQUhGIiwic291cmNlc0NvbnRlbnQiOlsie2Jhc2VuYW1lfSA9IHJlcXVpcmUgXCJwYXRoXCJcblxubW9kdWxlLmV4cG9ydHMgPVxuICBjb25maWc6XG4gICAgY29sb3VyZWQ6XG4gICAgICB0eXBlOiAnYm9vbGVhbidcbiAgICAgIGRlZmF1bHQ6IHRydWVcbiAgICAgIGRlc2NyaXB0aW9uOiAnVW50aWNrIHRoaXMgZm9yIGNvbG91cmxlc3MgaWNvbnMnXG4gICAgZm9yY2VTaG93OlxuICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICBkZWZhdWx0OiBmYWxzZVxuICAgICAgZGVzY3JpcHRpb246ICdGb3JjZSBzaG93IGljb25zIC0gZm9yIHRoZW1lcyB0aGF0IGhpZGUgaWNvbnMnXG4gICAgb25DaGFuZ2VzOlxuICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICBkZWZhdWx0OiBmYWxzZVxuICAgICAgdGl0bGU6ICdPbmx5IGNvbG91ciB3aGVuIGNoYW5nZWQnXG4gICAgICBkZXNjcmlwdGlvbjogJ1Nob3cgZGlmZmVyZW50IGljb24gY29sb3VycyBmb3IgbW9kaWZpZWQgZmlsZXMgb25seS4gUmVxdWlyZXMgdGhhdCBwcm9qZWN0IGJlIGEgR2l0IHJlcG9zaXRvcnkuJ1xuICAgIHRhYlBhbmVJY29uOlxuICAgICAgdHlwZTogJ2Jvb2xlYW4nXG4gICAgICBkZWZhdWx0OiB0cnVlXG4gICAgICB0aXRsZTogJ1Nob3cgaWNvbnMgaW4gZmlsZSB0YWJzJ1xuXG4gIGFjdGl2YXRlOiAoc3RhdGUpIC0+XG4gICAgQGRpc2FibGVTZXRpSWNvbnMgdHJ1ZVxuICAgIFxuICAgIGNvbG91cmVkSWNvbnMgPSBcImZpbGUtaWNvbnMuY29sb3VyZWRcIlxuICAgIGF0b20uY29uZmlnLm9uRGlkQ2hhbmdlIGNvbG91cmVkSWNvbnMsICh7bmV3VmFsdWUsIG9sZFZhbHVlfSkgPT5cbiAgICAgIEBjb2xvdXIgbmV3VmFsdWVcbiAgICBAY29sb3VyIGF0b20uY29uZmlnLmdldCBjb2xvdXJlZEljb25zXG4gICAgYXRvbS5jb21tYW5kcy5hZGQgJ2JvZHknLCAnZmlsZS1pY29uczp0b2dnbGUtY29sb3VycycsIChldmVudCkgLT5cbiAgICAgIGF0b20uY29uZmlnLnNldCBjb2xvdXJlZEljb25zLCAhKGF0b20uY29uZmlnLmdldCBjb2xvdXJlZEljb25zKVxuICAgIFxuICAgIEBvYnNlcnZlIHRydWVcbiAgICBcbiAgICAjIGdoLTQzNTogU3RyaXAgcGF0aCBhdHRyaWJ1dGVzIGZyb20gTWFya2Rvd24tUHJldmlldyBvbiBzdGFydHVwXG4gICAgYXRvbS5wYWNrYWdlcy5vbkRpZEFjdGl2YXRlSW5pdGlhbFBhY2thZ2VzIC0+XG4gICAgICBzZWxlY3RvciA9ICcuZmlsZS1pY29ucy10YWItcGFuZS1pY29uIC50YWJbZGF0YS10eXBlPVwiTWFya2Rvd25QcmV2aWV3Vmlld1wiXSdcbiAgICAgIHRhYnMgPSBhdG9tLnZpZXdzLmdldFZpZXcoYXRvbS53b3Jrc3BhY2UpLnF1ZXJ5U2VsZWN0b3JBbGwoc2VsZWN0b3IpXG4gICAgICBmb3IgdGFiIGluIHRhYnNcbiAgICAgICAgdGFiLml0ZW1UaXRsZS5yZW1vdmVBdHRyaWJ1dGUgXCJkYXRhLXBhdGhcIlxuXG4gICAgYXRvbS5jb25maWcub25EaWRDaGFuZ2UgJ2ZpbGUtaWNvbnMuZm9yY2VTaG93JywgKHtuZXdWYWx1ZSwgb2xkVmFsdWV9KSA9PlxuICAgICAgQGZvcmNlU2hvdyBuZXdWYWx1ZVxuICAgIEBmb3JjZVNob3cgYXRvbS5jb25maWcuZ2V0ICdmaWxlLWljb25zLmZvcmNlU2hvdydcblxuICAgIGF0b20uY29uZmlnLm9uRGlkQ2hhbmdlICdmaWxlLWljb25zLm9uQ2hhbmdlcycsICh7bmV3VmFsdWUsIG9sZFZhbHVlfSkgPT5cbiAgICAgIEBvbkNoYW5nZXMgbmV3VmFsdWVcbiAgICBAb25DaGFuZ2VzIGF0b20uY29uZmlnLmdldCAnZmlsZS1pY29ucy5vbkNoYW5nZXMnXG5cbiAgICBhdG9tLmNvbmZpZy5vbkRpZENoYW5nZSAnZmlsZS1pY29ucy50YWJQYW5lSWNvbicsICh7bmV3VmFsdWUsIG9sZFZhbHVlfSkgPT5cbiAgICAgIEB0YWJQYW5lSWNvbiBuZXdWYWx1ZVxuICAgIEB0YWJQYW5lSWNvbiBhdG9tLmNvbmZpZy5nZXQgJ2ZpbGUtaWNvbnMudGFiUGFuZUljb24nXG5cblxuICBkZWFjdGl2YXRlOiAtPlxuICAgIEBkaXNhYmxlU2V0aUljb25zIGZhbHNlXG4gICAgQGZvcmNlU2hvdyBmYWxzZVxuICAgIEBvbkNoYW5nZXMgZmFsc2VcbiAgICBAY29sb3VyIHRydWVcbiAgICBAdGFiUGFuZUljb24gZmFsc2VcbiAgICBAb2JzZXJ2ZSBmYWxzZVxuXG5cbiAgb2JzZXJ2ZTogKGVuYWJsZWQpIC0+XG4gICAgXG4gICAgIyBTZXR0aW5nIHVwIG9ic2VydmVyc1xuICAgIGlmIGVuYWJsZWRcbiAgICAgIEBvYnNlcnZlciA9IGF0b20ud29ya3NwYWNlLm9ic2VydmVUZXh0RWRpdG9ycyAoZWRpdG9yKSAtPlxuICAgICAgICB3b3Jrc3BhY2UgPSBhdG9tLnZpZXdzLmdldFZpZXcoYXRvbS53b3Jrc3BhY2UpXG4gICAgICAgIG9wZW5lZEZpbGUgPSBlZGl0b3IuZ2V0UGF0aCgpXG4gICAgICAgIFxuICAgICAgICAjIEZpeGVzIHRhYiBpY29ucyBhZnRlciBlZGl0b3IncyBmaW5pc2hlZCBpbml0aWFsaXNpbmdcbiAgICAgICAgZml4QWZ0ZXJMb2FkaW5nID0gKCkgLT5cbiAgICAgICAgICBvbkRvbmUgPSBlZGl0b3Iub25EaWRTdG9wQ2hhbmdpbmcgKCkgLT5cbiAgICAgICAgICAgIHRhYnMgPSB3b3Jrc3BhY2U/LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucGFuZSA+IC50YWItYmFyID4gLnRhYlwiKVxuICAgICAgICAgICAgZmlsZVRhYnMgPSBbXS5maWx0ZXIuY2FsbCB0YWJzLCAodGFiKSAtPiB0YWI/Lml0ZW0gaXMgZWRpdG9yXG4gICAgICAgICAgICBcbiAgICAgICAgICAgICMgV2hlbiBhIGZpbGUncyBiZWVuIHJlbmFtZWQsIHBhdGNoIHRoZSBkYXRhc2V0IG9mIGVhY2ggdGFiIHRoYXQgaGFzIGl0IG9wZW5cbiAgICAgICAgICAgIGVkaXRvci5vbkRpZENoYW5nZVBhdGggKHBhdGgpID0+XG4gICAgICAgICAgICAgIGZvciB0YWIgaW4gZmlsZVRhYnNcbiAgICAgICAgICAgICAgICB0aXRsZSA9IHRhYi5pdGVtVGl0bGVcbiAgICAgICAgICAgICAgICB0aXRsZS5kYXRhc2V0LnBhdGggPSBwYXRoXG4gICAgICAgICAgICAgICAgdGl0bGUuZGF0YXNldC5uYW1lID0gYmFzZW5hbWUgcGF0aFxuICAgICAgICAgICAgXG4gICAgICAgICAgICAjIERyb3AgdGhlIHJlZ2lzdHJhdGlvbiBsaXN0ZW5lclxuICAgICAgICAgICAgb25Eb25lLmRpc3Bvc2UoKVxuICAgICAgICBcbiAgICAgICAgXG4gICAgICAgICMgTmV3IGZpbGVcbiAgICAgICAgdW5sZXNzIG9wZW5lZEZpbGVcbiAgICAgICAgICBvblNhdmUgPSBlZGl0b3Iub25EaWRTYXZlIChmaWxlKSAtPlxuICAgICAgICAgICAgdGFiID0gd29ya3NwYWNlPy5xdWVyeVNlbGVjdG9yKFwiLnRhYi1iYXIgPiAuYWN0aXZlLnRhYiA+IC50aXRsZVwiKVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAjIFBhdGNoIGRhdGEtKiBhdHRyaWJ1dGVzIHRvIGZpeCBtaXNzaW5nIHRhYi1pY29uXG4gICAgICAgICAgICBmaXhJY29uID0gKCkgLT5cbiAgICAgICAgICAgICAgaWYgbm90IHRhYj8uZGF0YXNldC5wYXRoXG4gICAgICAgICAgICAgICAge3BhdGh9ID0gZmlsZVxuICAgICAgICAgICAgICAgIHRhYi5kYXRhc2V0LnBhdGggPSBwYXRoXG4gICAgICAgICAgICAgICAgdGFiLmRhdGFzZXQubmFtZSA9IGJhc2VuYW1lIHBhdGhcbiAgICAgICAgICAgICAgICBmaXhBZnRlckxvYWRpbmcoKVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAjIE1ha2Ugc3VyZSB0YWIncyBhY3R1YWxseSB2aXNpYmxlXG4gICAgICAgICAgICBpZiB0YWIgdGhlbiBmaXhJY29uKClcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgIyBUYWIgd2Fzbid0IGZvdW5kOyBzb21ldGhpbmcgd2VpcmQgaGFwcGVuZWQgd2l0aCBwZW5kaW5nIHBhbmVzXG4gICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgIG9uVGVybWluYXRlID0gZWRpdG9yLm9uRGlkVGVybWluYXRlUGVuZGluZ1N0YXRlICgpIC0+XG4gICAgICAgICAgICAgICAgc2V0VGltZW91dCAoLT5cbiAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgIyBUcnkgYWdhaW5cbiAgICAgICAgICAgICAgICAgIHRhYiA9IHdvcmtzcGFjZT8ucXVlcnlTZWxlY3RvcihcIi50YWItYmFyID4gLmFjdGl2ZS50YWIgPiAudGl0bGVcIilcbiAgICAgICAgICAgICAgICAgIGZpeEljb24oKVxuICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgKSwgMTBcbiAgICAgICAgICAgICAgICBvblRlcm1pbmF0ZS5kaXNwb3NlKClcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgIyBSZW1vdmUgdGhlIGxpc3RlbmVyXG4gICAgICAgICAgICBvblNhdmUuZGlzcG9zZSgpXG4gICAgICAgIFxuICAgICAgICAjIEV4aXN0aW5nIGZpbGU6IHdhaXQgZm9yIHBhbmUgdG8gZmluaXNoIGxvYWRpbmcgYmVmb3JlIHF1ZXJ5aW5nIHRoZSBET01cbiAgICAgICAgZWxzZVxuICAgICAgICAgIGZpeEFmdGVyTG9hZGluZygpXG4gICAgXG4gICAgIyBEaXNhYmxlIG9ic2VydmVycyBpZiBkZWFjdGl2YXRpbmcgcGFja2FnZVxuICAgIGVsc2UgaWYgQG9ic2VydmVyP1xuICAgICAgQG9ic2VydmVyLmRpc3Bvc2UoKVxuXG5cbiAgc2VyaWFsaXplOiAtPlxuICAgICMgY29uc29sZS5sb2cgJ3NlcmlhbGl6ZSdcblxuICBjb2xvdXI6IChlbmFibGUpIC0+XG4gICAgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgJ2JvZHknXG4gICAgYm9keS5jbGFzc0xpc3QudG9nZ2xlICdmaWxlLWljb25zLWNvbG91cmxlc3MnLCAhZW5hYmxlXG5cbiAgZm9yY2VTaG93OiAoZW5hYmxlKSAtPlxuICAgIGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yICdib2R5J1xuICAgIGJvZHkuY2xhc3NMaXN0LnRvZ2dsZSAnZmlsZS1pY29ucy1mb3JjZS1zaG93LWljb25zJywgZW5hYmxlXG5cbiAgb25DaGFuZ2VzOiAoZW5hYmxlKSAtPlxuICAgIGJvZHkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yICdib2R5J1xuICAgIGJvZHkuY2xhc3NMaXN0LnRvZ2dsZSAnZmlsZS1pY29ucy1vbi1jaGFuZ2VzJywgZW5hYmxlXG5cbiAgdGFiUGFuZUljb246IChlbmFibGUpIC0+XG4gICAgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IgJ2JvZHknXG4gICAgYm9keS5jbGFzc0xpc3QudG9nZ2xlICdmaWxlLWljb25zLXRhYi1wYW5lLWljb24nLCBlbmFibGVcblxuICBkaXNhYmxlU2V0aUljb25zOiAoZGlzYWJsZSkgLT5cbiAgICB3b3Jrc3BhY2VFbGVtZW50ID0gYXRvbS52aWV3cy5nZXRWaWV3KGF0b20ud29ya3NwYWNlKVxuICAgIHdvcmtzcGFjZUVsZW1lbnQuY2xhc3NMaXN0LnRvZ2dsZSAnc2V0aS11aS1uby1pY29ucycsIGRpc2FibGVcbiJdfQ==
