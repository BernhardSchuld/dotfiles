Object.defineProperty(exports, '__esModule', {
	value: true
});
/** @babel */

var init = function init() {
	var editor = atom.workspace.getActiveTextEditor();
	if (!editor) {
		return;
	}
	var buffer = editor.getBuffer();
	if (typeof buffer.editorconfig === 'undefined') {
		return;
	}

	var settings = buffer.editorconfig.settings;
	var checkpoint = buffer.createCheckpoint();
	var fixedProperties = {
		end_of_line: 0, // eslint-disable-line camelcase
		indent_style: 0 // eslint-disable-line camelcase
	};

	// fix end_of_line, if necessary
	if (settings.end_of_line !== 'auto') {
		var lastRow = buffer.getLastRow();
		for (var i = 0; i < lastRow; i++) {
			if (buffer.lineEndingForRow(i) !== settings.end_of_line && buffer.lineEndingForRow(i) !== '') {
				buffer.setTextInRange([[i, buffer.lineLengthForRow(i)], [i + 1, 0]], settings.end_of_line, { normalizeLineEndings: false });
				fixedProperties.end_of_line++;
			}
		}
	}

	// fix indent_style, if necessary
	if (settings.indent_style !== 'auto') {
		(function () {
			var softTabs = settings.indent_style === 'space';
			var spaceChar = { 'true': ' ', 'false': '\\t' };
			var tabLength = editor.getTabLength();
			var searchPattern = '^([' + spaceChar[softTabs] + ']*[' + spaceChar[!softTabs] + ']\\s*)';

			if (tabLength > 0) {
				buffer.backwardsScan(new RegExp(searchPattern, 'gm'), function (scan) {
					var displaySize = scan.matchText.split('').reduce(function (prev, curr, index) {
						if (curr === ' ') {
							return prev + 1;
						}
						return prev + tabLength - index % tabLength;
					}, 0);

					// eslint-disable-next-line camelcase
					fixedProperties.indent_style += Math.max(displaySize, Math.floor(displaySize / tabLength));
					if (softTabs) {
						scan.replace(' '.repeat(displaySize));
					} else {
						scan.replace('\t'.repeat(Math.floor(displaySize / tabLength)));
					}
				});
			}
		})();
	}

	// Sum changes up
	var changesInTotal = 0;
	for (var property in fixedProperties) {
		if (({}).hasOwnProperty.call(fixedProperties, property)) {
			changesInTotal += fixedProperties[property];
		}
	}

	// Prepare notification & save changes
	var notificationOptions = { dismissable: true };
	if (changesInTotal > 0) {
		buffer.groupChangesSinceCheckpoint(checkpoint);
		notificationOptions.description = '\n|Fixed EditorConfig-Properties||\n|--------|------:|\n|`end_of_line`|' + fixedProperties.end_of_line + '|\n|`indent_style`|' + fixedProperties.indent_style + '|\n|Changes in total|**' + changesInTotal + '**|\n';
	} else {
		notificationOptions.description = '\nThe file ' + editor.getTitle() + ' conformed to the `end_of_line` and `indent_style` properties.\nNo changes were applied.\n';
	}
	atom.notifications.addSuccess(editor.getTitle(), notificationOptions);
};

var subscriber = function subscriber() {
	atom.commands.add('atom-workspace', 'EditorConfig:fix-file', init);
};

exports['default'] = subscriber;
exports.init = init;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9hcm5lc2NocmV1ZGVyLy5kb3RmaWxlcy9hdG9tL2F0b20uc3ltbGluay9wYWNrYWdlcy9hdG9tLXR5cGVzY3JpcHQvbm9kZV9tb2R1bGVzL2ZzZXZlbnRzL2J1aWxkL1JlbGVhc2UvLmRlcHMvVXNlcnMvYXJuZXNjaHJldWRlci8uZG90ZmlsZXMvYXRvbS9hdG9tLnN5bWxpbmsvcGFja2FnZXMvZWRpdG9yY29uZmlnL2NvbW1hbmRzL2ZpeC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUVBLElBQU0sSUFBSSxHQUFHLFNBQVAsSUFBSSxHQUFTO0FBQ2xCLEtBQU0sTUFBTSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztBQUNwRCxLQUFJLENBQUMsTUFBTSxFQUFFO0FBQ1osU0FBTztFQUNQO0FBQ0QsS0FBTSxNQUFNLEdBQUcsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDO0FBQ2xDLEtBQUksT0FBTyxNQUFNLENBQUMsWUFBWSxLQUFLLFdBQVcsRUFBRTtBQUMvQyxTQUFPO0VBQ1A7O0FBRUQsS0FBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUM7QUFDOUMsS0FBTSxVQUFVLEdBQUcsTUFBTSxDQUFDLGdCQUFnQixFQUFFLENBQUM7QUFDN0MsS0FBTSxlQUFlLEdBQUc7QUFDdkIsYUFBVyxFQUFFLENBQUM7QUFDZCxjQUFZLEVBQUUsQ0FBQztFQUNmLENBQUM7OztBQUdGLEtBQUksUUFBUSxDQUFDLFdBQVcsS0FBSyxNQUFNLEVBQUU7QUFDcEMsTUFBTSxPQUFPLEdBQUcsTUFBTSxDQUFDLFVBQVUsRUFBRSxDQUFDO0FBQ3BDLE9BQUssSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxPQUFPLEVBQUUsQ0FBQyxFQUFFLEVBQUU7QUFDakMsT0FBSSxNQUFNLENBQUMsZ0JBQWdCLENBQUMsQ0FBQyxDQUFDLEtBQUssUUFBUSxDQUFDLFdBQVcsSUFDdEQsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUMsQ0FBQyxLQUFLLEVBQUUsRUFBRTtBQUNuQyxVQUFNLENBQUMsY0FBYyxDQUNwQixDQUNDLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxFQUMvQixDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQ1YsRUFDRCxRQUFRLENBQUMsV0FBVyxFQUNwQixFQUFDLG9CQUFvQixFQUFFLEtBQUssRUFBQyxDQUM3QixDQUFDO0FBQ0YsbUJBQWUsQ0FBQyxXQUFXLEVBQUUsQ0FBQztJQUM5QjtHQUNEO0VBQ0Q7OztBQUdELEtBQUksUUFBUSxDQUFDLFlBQVksS0FBSyxNQUFNLEVBQUU7O0FBQ3JDLE9BQU0sUUFBUSxHQUFHLFFBQVEsQ0FBQyxZQUFZLEtBQUssT0FBTyxDQUFDO0FBQ25ELE9BQU0sU0FBUyxHQUFHLEVBQUMsUUFBTSxHQUFHLEVBQUUsU0FBTyxLQUFLLEVBQUMsQ0FBQztBQUM1QyxPQUFNLFNBQVMsR0FBRyxNQUFNLENBQUMsWUFBWSxFQUFFLENBQUM7QUFDeEMsT0FBTSxhQUFhLFdBQVMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxXQUFNLFNBQVMsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxXQUFRLENBQUM7O0FBRWxGLE9BQUksU0FBUyxHQUFHLENBQUMsRUFBRTtBQUNsQixVQUFNLENBQUMsYUFBYSxDQUFDLElBQUksTUFBTSxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUMsRUFBRSxVQUFBLElBQUksRUFBSTtBQUM3RCxTQUFNLFdBQVcsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsQ0FBQyxNQUFNLENBQUMsVUFBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBSztBQUMxRSxVQUFJLElBQUksS0FBSyxHQUFHLEVBQUU7QUFDakIsY0FBTyxJQUFJLEdBQUcsQ0FBQyxDQUFDO09BQ2hCO0FBQ0QsYUFBTyxJQUFJLEdBQUcsU0FBUyxHQUFJLEtBQUssR0FBRyxTQUFTLEFBQUMsQ0FBQztNQUM5QyxFQUFFLENBQUMsQ0FBQyxDQUFDOzs7QUFHTixvQkFBZSxDQUFDLFlBQVksSUFBSSxJQUFJLENBQUMsR0FBRyxDQUN2QyxXQUFXLEVBQUUsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDLENBQ2hELENBQUM7QUFDRixTQUFJLFFBQVEsRUFBRTtBQUNiLFVBQUksQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO01BQ3RDLE1BQU07QUFDTixVQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxXQUFXLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDO01BQy9EO0tBQ0QsQ0FBQyxDQUFDO0lBQ0g7O0VBQ0Q7OztBQUdELEtBQUksY0FBYyxHQUFHLENBQUMsQ0FBQztBQUN2QixNQUFLLElBQU0sUUFBUSxJQUFJLGVBQWUsRUFBRTtBQUN2QyxNQUFJLENBQUEsR0FBRSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLFFBQVEsQ0FBQyxFQUFFO0FBQ3RELGlCQUFjLElBQUksZUFBZSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0dBQzVDO0VBQ0Q7OztBQUdELEtBQU0sbUJBQW1CLEdBQUcsRUFBQyxXQUFXLEVBQUUsSUFBSSxFQUFDLENBQUM7QUFDaEQsS0FBSSxjQUFjLEdBQUcsQ0FBQyxFQUFFO0FBQ3ZCLFFBQU0sQ0FBQywyQkFBMkIsQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUMvQyxxQkFBbUIsQ0FBQyxXQUFXLCtFQUdkLGVBQWUsQ0FBQyxXQUFXLDJCQUMxQixlQUFlLENBQUMsWUFBWSwrQkFDMUIsY0FBYyxVQUNuQyxDQUFDO0VBQ0EsTUFBTTtBQUNOLHFCQUFtQixDQUFDLFdBQVcsbUJBQ3RCLE1BQU0sQ0FBQyxRQUFRLEVBQUUsK0ZBRTNCLENBQUM7RUFDQTtBQUNELEtBQUksQ0FBQyxhQUFhLENBQUMsVUFBVSxDQUFDLE1BQU0sQ0FBQyxRQUFRLEVBQUUsRUFBRSxtQkFBbUIsQ0FBQyxDQUFDO0NBQ3RFLENBQUM7O0FBRUYsSUFBTSxVQUFVLEdBQUcsU0FBYixVQUFVLEdBQVM7QUFDeEIsS0FBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsdUJBQXVCLEVBQUUsSUFBSSxDQUFDLENBQUM7Q0FDbkUsQ0FBQzs7cUJBRU0sVUFBVTtRQUFhLElBQUksR0FBSixJQUFJIiwiZmlsZSI6Ii9Vc2Vycy9hcm5lc2NocmV1ZGVyLy5kb3RmaWxlcy9hdG9tL2F0b20uc3ltbGluay9wYWNrYWdlcy9hdG9tLXR5cGVzY3JpcHQvbm9kZV9tb2R1bGVzL2ZzZXZlbnRzL2J1aWxkL1JlbGVhc2UvLmRlcHMvVXNlcnMvYXJuZXNjaHJldWRlci8uZG90ZmlsZXMvYXRvbS9hdG9tLnN5bWxpbmsvcGFja2FnZXMvZWRpdG9yY29uZmlnL2NvbW1hbmRzL2ZpeC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKiBAYmFiZWwgKi9cblxuY29uc3QgaW5pdCA9ICgpID0+IHtcblx0Y29uc3QgZWRpdG9yID0gYXRvbS53b3Jrc3BhY2UuZ2V0QWN0aXZlVGV4dEVkaXRvcigpO1xuXHRpZiAoIWVkaXRvcikge1xuXHRcdHJldHVybjtcblx0fVxuXHRjb25zdCBidWZmZXIgPSBlZGl0b3IuZ2V0QnVmZmVyKCk7XG5cdGlmICh0eXBlb2YgYnVmZmVyLmVkaXRvcmNvbmZpZyA9PT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRyZXR1cm47XG5cdH1cblxuXHRjb25zdCBzZXR0aW5ncyA9IGJ1ZmZlci5lZGl0b3Jjb25maWcuc2V0dGluZ3M7XG5cdGNvbnN0IGNoZWNrcG9pbnQgPSBidWZmZXIuY3JlYXRlQ2hlY2twb2ludCgpO1xuXHRjb25zdCBmaXhlZFByb3BlcnRpZXMgPSB7XG5cdFx0ZW5kX29mX2xpbmU6IDAsIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY2FtZWxjYXNlXG5cdFx0aW5kZW50X3N0eWxlOiAwIC8vIGVzbGludC1kaXNhYmxlLWxpbmUgY2FtZWxjYXNlXG5cdH07XG5cblx0Ly8gZml4IGVuZF9vZl9saW5lLCBpZiBuZWNlc3Nhcnlcblx0aWYgKHNldHRpbmdzLmVuZF9vZl9saW5lICE9PSAnYXV0bycpIHtcblx0XHRjb25zdCBsYXN0Um93ID0gYnVmZmVyLmdldExhc3RSb3coKTtcblx0XHRmb3IgKGxldCBpID0gMDsgaSA8IGxhc3RSb3c7IGkrKykge1xuXHRcdFx0aWYgKGJ1ZmZlci5saW5lRW5kaW5nRm9yUm93KGkpICE9PSBzZXR0aW5ncy5lbmRfb2ZfbGluZSAmJlxuXHRcdFx0XHRidWZmZXIubGluZUVuZGluZ0ZvclJvdyhpKSAhPT0gJycpIHtcblx0XHRcdFx0YnVmZmVyLnNldFRleHRJblJhbmdlKFxuXHRcdFx0XHRcdFtcblx0XHRcdFx0XHRcdFtpLCBidWZmZXIubGluZUxlbmd0aEZvclJvdyhpKV0sXG5cdFx0XHRcdFx0XHRbaSArIDEsIDBdXG5cdFx0XHRcdFx0XSxcblx0XHRcdFx0XHRzZXR0aW5ncy5lbmRfb2ZfbGluZSxcblx0XHRcdFx0XHR7bm9ybWFsaXplTGluZUVuZGluZ3M6IGZhbHNlfVxuXHRcdFx0XHQpO1xuXHRcdFx0XHRmaXhlZFByb3BlcnRpZXMuZW5kX29mX2xpbmUrKztcblx0XHRcdH1cblx0XHR9XG5cdH1cblxuXHQvLyBmaXggaW5kZW50X3N0eWxlLCBpZiBuZWNlc3Nhcnlcblx0aWYgKHNldHRpbmdzLmluZGVudF9zdHlsZSAhPT0gJ2F1dG8nKSB7XG5cdFx0Y29uc3Qgc29mdFRhYnMgPSBzZXR0aW5ncy5pbmRlbnRfc3R5bGUgPT09ICdzcGFjZSc7XG5cdFx0Y29uc3Qgc3BhY2VDaGFyID0ge3RydWU6ICcgJywgZmFsc2U6ICdcXFxcdCd9O1xuXHRcdGNvbnN0IHRhYkxlbmd0aCA9IGVkaXRvci5nZXRUYWJMZW5ndGgoKTtcblx0XHRjb25zdCBzZWFyY2hQYXR0ZXJuID0gYF4oWyR7c3BhY2VDaGFyW3NvZnRUYWJzXX1dKlske3NwYWNlQ2hhclshc29mdFRhYnNdfV1cXFxccyopYDtcblxuXHRcdGlmICh0YWJMZW5ndGggPiAwKSB7XG5cdFx0XHRidWZmZXIuYmFja3dhcmRzU2NhbihuZXcgUmVnRXhwKHNlYXJjaFBhdHRlcm4sICdnbScpLCBzY2FuID0+IHtcblx0XHRcdFx0Y29uc3QgZGlzcGxheVNpemUgPSBzY2FuLm1hdGNoVGV4dC5zcGxpdCgnJykucmVkdWNlKChwcmV2LCBjdXJyLCBpbmRleCkgPT4ge1xuXHRcdFx0XHRcdGlmIChjdXJyID09PSAnICcpIHtcblx0XHRcdFx0XHRcdHJldHVybiBwcmV2ICsgMTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cmV0dXJuIHByZXYgKyB0YWJMZW5ndGggLSAoaW5kZXggJSB0YWJMZW5ndGgpO1xuXHRcdFx0XHR9LCAwKTtcblxuXHRcdFx0XHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY2FtZWxjYXNlXG5cdFx0XHRcdGZpeGVkUHJvcGVydGllcy5pbmRlbnRfc3R5bGUgKz0gTWF0aC5tYXgoXG5cdFx0XHRcdFx0ZGlzcGxheVNpemUsIE1hdGguZmxvb3IoZGlzcGxheVNpemUgLyB0YWJMZW5ndGgpXG5cdFx0XHRcdCk7XG5cdFx0XHRcdGlmIChzb2Z0VGFicykge1xuXHRcdFx0XHRcdHNjYW4ucmVwbGFjZSgnICcucmVwZWF0KGRpc3BsYXlTaXplKSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0c2Nhbi5yZXBsYWNlKCdcXHQnLnJlcGVhdChNYXRoLmZsb29yKGRpc3BsYXlTaXplIC8gdGFiTGVuZ3RoKSkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cdH1cblxuXHQvLyBTdW0gY2hhbmdlcyB1cFxuXHRsZXQgY2hhbmdlc0luVG90YWwgPSAwO1xuXHRmb3IgKGNvbnN0IHByb3BlcnR5IGluIGZpeGVkUHJvcGVydGllcykge1xuXHRcdGlmICh7fS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGZpeGVkUHJvcGVydGllcywgcHJvcGVydHkpKSB7XG5cdFx0XHRjaGFuZ2VzSW5Ub3RhbCArPSBmaXhlZFByb3BlcnRpZXNbcHJvcGVydHldO1xuXHRcdH1cblx0fVxuXG5cdC8vIFByZXBhcmUgbm90aWZpY2F0aW9uICYgc2F2ZSBjaGFuZ2VzXG5cdGNvbnN0IG5vdGlmaWNhdGlvbk9wdGlvbnMgPSB7ZGlzbWlzc2FibGU6IHRydWV9O1xuXHRpZiAoY2hhbmdlc0luVG90YWwgPiAwKSB7XG5cdFx0YnVmZmVyLmdyb3VwQ2hhbmdlc1NpbmNlQ2hlY2twb2ludChjaGVja3BvaW50KTtcblx0XHRub3RpZmljYXRpb25PcHRpb25zLmRlc2NyaXB0aW9uID0gYFxufEZpeGVkIEVkaXRvckNvbmZpZy1Qcm9wZXJ0aWVzfHxcbnwtLS0tLS0tLXwtLS0tLS06fFxufFxcYGVuZF9vZl9saW5lXFxgfCR7Zml4ZWRQcm9wZXJ0aWVzLmVuZF9vZl9saW5lfXxcbnxcXGBpbmRlbnRfc3R5bGVcXGB8JHtmaXhlZFByb3BlcnRpZXMuaW5kZW50X3N0eWxlfXxcbnxDaGFuZ2VzIGluIHRvdGFsfCoqJHtjaGFuZ2VzSW5Ub3RhbH0qKnxcbmA7XG5cdH0gZWxzZSB7XG5cdFx0bm90aWZpY2F0aW9uT3B0aW9ucy5kZXNjcmlwdGlvbiA9IGBcblRoZSBmaWxlICR7ZWRpdG9yLmdldFRpdGxlKCl9IGNvbmZvcm1lZCB0byB0aGUgXFxgZW5kX29mX2xpbmVcXGAgYW5kIFxcYGluZGVudF9zdHlsZVxcYCBwcm9wZXJ0aWVzLlxuTm8gY2hhbmdlcyB3ZXJlIGFwcGxpZWQuXG5gO1xuXHR9XG5cdGF0b20ubm90aWZpY2F0aW9ucy5hZGRTdWNjZXNzKGVkaXRvci5nZXRUaXRsZSgpLCBub3RpZmljYXRpb25PcHRpb25zKTtcbn07XG5cbmNvbnN0IHN1YnNjcmliZXIgPSAoKSA9PiB7XG5cdGF0b20uY29tbWFuZHMuYWRkKCdhdG9tLXdvcmtzcGFjZScsICdFZGl0b3JDb25maWc6Zml4LWZpbGUnLCBpbml0KTtcbn07XG5cbmV4cG9ydCB7c3Vic2NyaWJlciBhcyBkZWZhdWx0LCBpbml0fTtcbiJdfQ==